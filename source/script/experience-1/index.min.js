function random(a,b){return Math.random()*(b-a)+a}function debug(a,b){console.log(a)}function Vector(){this.x=0,this.y=0,this.set=function(a,b){this.x=a,this.y=b},this.scl=function(a){this.x*=a,this.y*=a},this.add=function(a){this.x+=a.x,this.y+=a.y},this.distance=function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))}}function createStyle(a){head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style"),style.type="text/css",style.title="experience-1",style.styleSheet?style.styleSheet.cssText=a:style.appendChild(document.createTextNode(a)),head.appendChild(style)}var Analyst=function(){this.push=function(a){this.datas.push(a)},this.pop=function(){debug(this.datas),this.clear()},this.clear=function(){this.datas=[]},this.datas=[]},Behavior=function(){this.act=function(a,b){if(a.distance(b)>this.detection)this.wander();else{var c=Math.atan2(b.y-a.y,b.x-a.x);this.state?this.pursuit(c):this.leak(c)}},this.pursuit=function(a){this.motion.x=.5*(this.velocity*Math.cos(a)/.25+this.oldMotion.x*this.inertia),this.motion.y=.5*(this.velocity*Math.sin(a)/.25+this.oldMotion.y*this.inertia)},this.leak=function(a){this.motion.x=.5*(-this.velocity*Math.cos(a)/.25+this.oldMotion.x*this.inertia),this.motion.y=.5*(-this.velocity*Math.sin(a)/.25+this.oldMotion.y*this.inertia)},this.wander=function(){this.motion.x=.5*(this.velocity*Math.cos(random(0,100))/.25+this.oldMotion.x*this.inertia),this.motion.y=.5*(this.velocity*Math.sin(random(0,100))/.25+this.oldMotion.y*this.inertia)},this.swapState=function(){this.state=!this.state},this.setProperties=function(a,b,c){this.velocity=a,this.inertia=b,this.detection=c},this.detection=300,this.velocity=.4,this.inertia=1.98,this.state=!1,this.motion=new Vector,this.oldMotion=new Vector},Block=function(a){this.act=function(a){this.behavior.act(this.shape.position,this.focus);var b=this.behavior.motion;b.scl(a/TIME),this.collide(this.shape.position,b),this.behavior.oldMotion.set(this.behavior.motion.x/(a/TIME),this.behavior.motion.y/(a/TIME)),this.shape.position.add(b)},this.move=function(a,b){this.shape.move(a,b)},this.collide=function(a,b){(a.x+b.x+this.shape.size>app.viewport.size.x||a.x+b.x<0)&&(b.x=-b.x*this.bounce),(a.y+b.y+this.shape.size>app.viewport.size.y||a.y+b.y<0)&&(b.y=-b.y*this.bounce)},this.changeColor=function(a){this.shape.body.style.borderColor=a},this.swapState=function(){this.behavior.swapState(),this.behavior.state?this.changeColor(RED):this.changeColor(BLUE)},this.setProperties=function(a){this.behavior.setProperties(a.velocity,a.inertia,a.detection),this.bounce=a.bounce},this.bounce=.5,this.focus=a,this.shape=new Shape("block"),this.behavior=new Behavior},Shape=function(a){this.act=function(){var a=this.position.x-b,c=this.position.y-b,d="translate("+a+"px,"+c+"px)";this.body.style["-webkit-transform"]=d,this.body.style["-moz-transform"]=d,this.body.style["-o-transform"]=d,this.body.style.transform=d},this.createBody=function(a){var b=document.createElement("div");return b.className=a,b},this.move=function(a,b){this.position.set(a,b)},this.position=new Vector,this.body=this.createBody(a),this.size=8;var b=this.size/2},BlockGroup=function(a,b){this.generate=function(a,b){this.clear(),this.properties.length=a,b&&(this.focus=b);for(var c=0;c<a;c++){var d=new Block(b);d.changeColor(BLUE),d.setProperties(this.properties),this.blocks.push(d)}},this.act=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].act(a)},this.clear=function(){this.blocks=[]},this.move=function(a,b){for(var c=0;c<this.blocks.length;c++)this.blocks[c].move(random(0,a-this.blocks[c].shape.size),random(0,b-this.blocks[c].shape.size))},this.changeColor=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].changeColor(a)},this.swapState=function(){for(var a=0;a<this.blocks.length;a++)this.blocks[a].swapState()},this.setProperties=function(a,b,c,d){this.properties.velocity=a,this.properties.inertia=b,this.properties.detection=c,this.properties.bounce=d;for(var e=0;e<this.blocks.length;e++)this.blocks[e].setProperties(this.properties)},this.getProperties=function(){return this.properties},this.properties={velocity:3,inertia:1.98,detection:300,bounce:.5,length:0},this.blocks=[],b&&(this.focus=b)},Stage=function(a){this.addGroup=function(a){for(var b=0;b<a.blocks.length;b++)this.addBlock(a.blocks[b])},this.addBlock=function(a){this.blocks.push(a),this.addShape(a.shape)},this.addShape=function(a){this.shapes.push(a),this.world.appendChild(a.body)},this.wipe=function(){if(this.world.hasChildNodes())for(;this.world.childNodes.length>=1;)this.world.removeChild(this.world.firstChild);this.blocks=[],this.shapes=[]},this.act=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].act(a);for(b=0;b<this.shapes.length;b++)this.shapes[b].act(a)},this.world=a,this.blocks=[],this.shapes=[]},Viewport=function(a){this.resize=function(){this.size.set(a.clientWidth,a.clientHeight),this.marge.set(window.innerWidth-this.size.x,window.innerHeight-this.size.y)},this.size=new Vector,this.marge=new Vector,this.resize()},Application=function(a,b){this.create=function(a){a||(a=Math.round(this.viewport.size.x*this.viewport.size.y/3e3)),this.stage.wipe(),this.blocksGroup.generate(a,this.cursor.position),this.blocksGroup.move(this.viewport.size.x,this.viewport.size.y),this.stage.addGroup(this.blocksGroup),this.stage.addShape(this.cursor)},this.update=function(){c=new Date;var a=c-d;d=c,app.stage.act(a)},this.resize=function(){this.viewport.resize(),this.create()},this.start=function(){d=new Date,c=new Date,e=setInterval(this.update,TIME/FPS)},this.stop=function(){clearInterval(e),e=0},this.mouseUpdate=function(a,b){this.cursor.position.set(a,b)},this.swapState=function(){this.blocksGroup.swapState()},this.setProperties=function(a,b,c,d,e){this.blocksGroup.clear(),this.create(e),this.blocksGroup.setProperties(a,b,c,d)},this.getProperties=function(){return this.blocksGroup.getProperties()};var c,d,e=0;this.blocksGroup=new BlockGroup,this.stage=new Stage(a),this.viewport=new Viewport(b),this.cursor=new Shape("cursor"),this.cursor.position.set(-this.viewport.size.x,-this.viewport.size.y)};const FPS=60,TIME=1e3,RED="#F44336",BLUE="#2196F3",cssMinified="*{box-sizing:border-box}#experience-1{position:absolute;bottom:0;right:0;left:0;top:0;overflow:hidden}#world{display:block;width:100%;height:100%;background-color:#212121;cursor:none}.block,.cursor{position:absolute;height:8px;width:8px;border:solid 1px;border-radius:100%}.block{background-color:#424242;transition:.2s color}.cursor{display:flex;align-items:center;justify-content:center;background-color:rgba(255,255,255,0.2);border-color:#fff}.cursor::after{height:2px;width:2px;background-color:#fff;border-radius:100%;content:' '}";var viewport=document.getElementById("experience-1");if(!viewport)throw"experience id not found";var world=document.createElement("div");world.setAttribute("id","world"),viewport.appendChild(world),createStyle(cssMinified);var app=new Application(world,viewport);viewport.addEventListener("mousemove",function(a){app.mouseUpdate(a.clientX,a.clientY)}),viewport.addEventListener("click",function(){app.swapState()}),window.addEventListener("resize",function(){app.resize()}),app.create(),app.start();