function random(t,i){return Math.random()*(i-t)+t}function debug(t,i){console.log(t)}function Vector(){this.y=this.x=0,this.set=function(t,i){this.x=t,this.y=i},this.scl=function(t){this.x*=t,this.y*=t},this.add=function(t){this.x+=t.x,this.y+=t.y},this.distance=function(t){return Math.sqrt(Math.pow(t.x-this.x,2)+Math.pow(t.y-this.y,2))}}var Analyst=function(){this.push=function(t){this.datas.push(t)},this.pop=function(){debug(this.datas),this.clear()},this.clear=function(){this.datas=[]},this.datas=[]},Behavior=function(){this.act=function(t,i){if(t.distance(i)>this.detection)this.wander();else{var s=Math.atan2(i.y-t.y,i.x-t.x);this.state?this.pursuit(s):this.leak(s)}},this.pursuit=function(t){this.motion.x=.5*(this.velocity*Math.cos(t)/.25+this.oldMotion.x*this.inertia),this.motion.y=.5*(this.velocity*Math.sin(t)/.25+this.oldMotion.y*this.inertia)},this.leak=function(t){this.motion.x=.5*(-this.velocity*Math.cos(t)/.25+this.oldMotion.x*this.inertia),this.motion.y=.5*(-this.velocity*Math.sin(t)/.25+this.oldMotion.y*this.inertia)},this.wander=function(){this.motion.x=.5*(this.velocity*Math.cos(random(0,100))/.25+this.oldMotion.x*this.inertia),this.motion.y=.5*(this.velocity*Math.sin(random(0,100))/.25+this.oldMotion.y*this.inertia)},this.swapState=function(){this.state=!this.state},this.setProperties=function(t,i,s){this.velocity=t,this.inertia=i,this.detection=s},this.detection=300,this.velocity=.4,this.inertia=1.98,this.state=!1,this.motion=new Vector,this.oldMotion=new Vector},Block=function(t){this.act=function(t){this.behavior.act(this.shape.position,this.focus);var i=this.behavior.motion;i.scl(t/TIME),this.collide(this.shape.position,i),this.behavior.oldMotion.set(this.behavior.motion.x/(t/TIME),this.behavior.motion.y/(t/TIME)),this.shape.position.add(i)},this.move=function(t,i){this.shape.move(t,i)},this.collide=function(t,i){(t.x+i.x+this.shape.size>app.viewport.size.x||0>t.x+i.x)&&(i.x=-i.x*this.bounce),(t.y+i.y+this.shape.size>app.viewport.size.y||0>t.y+i.y)&&(i.y=-i.y*this.bounce)},this.changeColor=function(t){this.shape.body.style.borderColor=t},this.swapState=function(){this.behavior.swapState(),this.behavior.state?this.changeColor(RED):this.changeColor(BLUE)},this.setProperties=function(t){this.behavior.setProperties(t.velocity,t.inertia,t.detection),this.bounce=t.bounce},this.bounce=.5,this.focus=t,this.shape=new Shape("block"),this.behavior=new Behavior},Shape=function(t){this.act=function(){var t="translate("+(this.position.x-i)+"px,"+(this.position.y-i)+"px)";this.body.style["-webkit-transform"]=t,this.body.style["-moz-transform"]=t,this.body.style["-o-transform"]=t,this.body.style.transform=t},this.createBody=function(t){var i=document.createElement("div");return i.className=t,i},this.move=function(t,i){this.position.set(t,i)},this.position=new Vector,this.body=this.createBody(t),this.size=8;var i=this.size/2},BlockGroup=function(t,i){this.generate=function(t,i){this.clear(),this.properties.length=t,i&&(this.focus=i);for(var s=0;t>s;s++){var e=new Block(i);e.changeColor(BLUE),e.setProperties(this.properties),this.blocks.push(e)}},this.act=function(t){for(var i=0;i<this.blocks.length;i++)this.blocks[i].act(t)},this.clear=function(){this.blocks=[]},this.move=function(t,i){for(var s=0;s<this.blocks.length;s++)this.blocks[s].move(random(0,t-this.blocks[s].shape.size),random(0,i-this.blocks[s].shape.size))},this.changeColor=function(t){for(var i=0;i<this.blocks.length;i++)this.blocks[i].changeColor(t)},this.swapState=function(){for(var t=0;t<this.blocks.length;t++)this.blocks[t].swapState()},this.setProperties=function(t,i,s,e){for(this.properties.velocity=t,this.properties.inertia=i,this.properties.detection=s,this.properties.bounce=e,t=0;t<this.blocks.length;t++)this.blocks[t].setProperties(this.properties)},this.getProperties=function(){return this.properties},this.properties={velocity:3,inertia:1.98,detection:300,bounce:.5,length:0},this.blocks=[],i&&(this.focus=i)},Stage=function(t){this.addGroup=function(t){for(var i=0;i<t.blocks.length;i++)this.addBlock(t.blocks[i])},this.addBlock=function(t){this.blocks.push(t),this.addShape(t.shape)},this.addShape=function(t){this.shapes.push(t),this.world.appendChild(t.body)},this.wipe=function(){if(this.world.hasChildNodes())for(;1<=this.world.childNodes.length;)this.world.removeChild(this.world.firstChild);this.blocks=[],this.shapes=[]},this.act=function(t){for(var i=0;i<this.blocks.length;i++)this.blocks[i].act(t);for(i=0;i<this.shapes.length;i++)this.shapes[i].act(t)},this.world=t,this.blocks=[],this.shapes=[]},Viewport=function(t){this.resize=function(){this.size.set(t.clientWidth,t.clientHeight),this.marge.set(window.innerWidth-this.size.x,window.innerHeight-this.size.y)},this.size=new Vector,this.marge=new Vector,this.resize()},Application=function(t,i){this.create=function(t){t||(t=Math.round(this.viewport.size.x*this.viewport.size.y/3e3)),this.stage.wipe(),this.blocksGroup.generate(t,this.cursor.position),this.blocksGroup.move(this.viewport.size.x,this.viewport.size.y),this.stage.addGroup(this.blocksGroup),this.stage.addShape(this.cursor)},this.update=function(){s=new Date;var t=s-e;e=s,app.stage.act(t)},this.resize=function(){this.viewport.resize(),this.create()},this.start=function(){e=new Date,s=new Date,o=setInterval(this.update,TIME/FPS)},this.stop=function(){clearInterval(o),o=0},this.mouseUpdate=function(t,i){this.cursor.position.set(t,i)},this.swapState=function(){this.blocksGroup.swapState()},this.setProperties=function(t,i,s,e,o){this.blocksGroup.clear(),this.create(o),this.blocksGroup.setProperties(t,i,s,e)},this.getProperties=function(){return this.blocksGroup.getProperties()};var s,e,o=0;this.blocksGroup=new BlockGroup,this.stage=new Stage(t),this.viewport=new Viewport(i),this.cursor=new Shape("cursor"),this.cursor.position.set(-this.viewport.size.x,-this.viewport.size.y)},BLUE="#2196F3",RED="#F44336",TIME=1e3,FPS=60,app=new Application(document.getElementById("world"),document.getElementById("viewport"));document.getElementById("viewport").addEventListener("click",function(){app.swapState()}),window.addEventListener("resize",function(){app.resize()}),document.getElementById("viewport").addEventListener("mousemove",function(t){app.mouseUpdate(t.clientX,t.clientY)}),app.create(),app.start();