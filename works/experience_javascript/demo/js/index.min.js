function random(c,a){return Math.random()*(a-c)+c}function debug(c,a){console.log(c);if(a)debugger}var Analyst=function(){this.push=function(c){this.datas.push(c)};this.pop=function(){debug(this.datas,!1);this.clear()};this.clear=function(){this.datas=[]};this.datas=[]};
function Vector(){this.y=this.x=0;this.set=function(c,a){this.x=c;this.y=a};this.scl=function(c){this.x*=c;this.y*=c};this.add=function(c){this.x+=c.x;this.y+=c.y};this.distance=function(c){return Math.sqrt(Math.pow(c.x-this.x,2)+Math.pow(c.y-this.y,2))}}
var Behavior=function(){this.act=function(c,a){if(c.distance(a)>this.detection)this.wander();else{var b=Math.atan2(a.y-c.y,a.x-c.x);this.state?this.pursuit(b):this.leak(b)}};this.pursuit=function(c){this.motion.x=.5*(this.velocity*Math.cos(c)/.25+this.oldMotion.x*this.inertia);this.motion.y=.5*(this.velocity*Math.sin(c)/.25+this.oldMotion.y*this.inertia)};this.leak=function(c){this.motion.x=.5*(-this.velocity*Math.cos(c)/.25+this.oldMotion.x*this.inertia);this.motion.y=.5*(-this.velocity*Math.sin(c)/
.25+this.oldMotion.y*this.inertia)};this.wander=function(){this.motion.x=.5*(this.velocity*Math.cos(random(0,100))/.25+this.oldMotion.x*this.inertia);this.motion.y=.5*(this.velocity*Math.sin(random(0,100))/.25+this.oldMotion.y*this.inertia)};this.swapState=function(){this.state=!this.state};this.setProperties=function(c,a,b){this.velocity=c;this.inertia=a;this.detection=b};this.detection=300;this.velocity=.4;this.inertia=1.98;this.state=!1;this.motion=new Vector;this.oldMotion=new Vector},Block=function(c){this.act=
function(a){this.behavior.act(this.shape.position,this.focus);var b=this.behavior.motion;b.scl(a/TIME);this.collide(this.shape.position,b);this.behavior.oldMotion.set(this.behavior.motion.x/(a/TIME),this.behavior.motion.y/(a/TIME));this.shape.position.add(b)};this.move=function(a,b){this.shape.move(a,b)};this.collide=function(a,b){if(a.x+b.x+this.shape.size>app.viewport.size.x||0>a.x+b.x)b.x=-b.x*this.bounce;if(a.y+b.y+this.shape.size>app.viewport.size.y||0>a.y+b.y)b.y=-b.y*this.bounce};this.changeColor=
function(a){this.shape.body.style.borderColor=a};this.swapState=function(){this.behavior.swapState();this.behavior.state?this.changeColor(RED):this.changeColor(BLUE)};this.setProperties=function(a){this.behavior.setProperties(a.velocity,a.inertia,a.detection);this.bounce=a.bounce};this.bounce=.5;this.focus=c;this.shape=new Shape(classNames.block);this.behavior=new Behavior},Shape=function(c){this.act=function(){var b="translate("+(this.position.x-a)+"px,"+(this.position.y-a)+"px)";this.body.style["-webkit-transform"]=
b;this.body.style["-moz-transform"]=b;this.body.style["-o-transform"]=b;this.body.style.transform=b};this.createBody=function(b){var a=document.createElement("div");a.className=b;return a};this.move=function(b,a){this.position.set(b,a)};this.position=new Vector;this.body=this.createBody(c);this.size=8;var a=this.size/2},BlockGroup=function(c,a){this.generate=function(b,a){this.clear();this.properties.length=b;a&&(this.focus=a);for(var c=0;c<b;c++){var f=new Block(a);f.changeColor(BLUE);f.setProperties(this.properties);
this.blocks.push(f)}};this.act=function(b){for(var a=0;a<this.blocks.length;a++)this.blocks[a].act(b)};this.clear=function(){this.blocks=[]};this.move=function(a,c){for(var b=0;b<this.blocks.length;b++)this.blocks[b].move(random(0,a-this.blocks[b].shape.size),random(0,c-this.blocks[b].shape.size))};this.changeColor=function(b){for(var a=0;a<this.blocks.length;a++)this.blocks[a].changeColor(b)};this.swapState=function(){for(var a=0;a<this.blocks.length;a++)this.blocks[a].swapState()};this.setProperties=
function(a,c,d,f){this.properties.velocity=a;this.properties.inertia=c;this.properties.detection=d;this.properties.bounce=f;for(a=0;a<this.blocks.length;a++)this.blocks[a].setProperties(this.properties)};this.getProperties=function(){return this.properties};this.properties={velocity:3,inertia:1.98,detection:300,bounce:.5,length:0};this.blocks=[];a&&(this.focus=a)},Stage=function(c){this.addGroup=function(a){for(var b=0;b<a.blocks.length;b++)this.addBlock(a.blocks[b])};this.addBlock=function(a){this.blocks.push(a);
this.addShape(a.shape)};this.addShape=function(a){this.shapes.push(a);this.world.appendChild(a.body)};this.wipe=function(){if(this.world.hasChildNodes())for(;1<=this.world.childNodes.length;)this.world.removeChild(this.world.firstChild);this.blocks=[];this.shapes=[]};this.act=function(a){for(var b=0;b<this.blocks.length;b++)this.blocks[b].act(a);for(b=0;b<this.shapes.length;b++)this.shapes[b].act(a)};this.world=c;this.blocks=[];this.shapes=[]},Viewport=function(c){this.resize=function(){this.size.set(c.clientWidth,
c.clientHeight);this.marge.set(window.innerWidth-this.size.x,window.innerHeight-this.size.y)};this.size=new Vector;this.marge=new Vector;this.resize()},Application=function(c,a){this.create=function(a){if(!a||0>a)a=Math.round(this.viewport.size.x*this.viewport.size.y/3E3);this.stage.wipe();this.blocksGroup.generate(a,this.cursor.position);this.blocksGroup.move(this.viewport.size.x,this.viewport.size.y);this.stage.addGroup(this.blocksGroup);this.stage.addShape(this.cursor)};this.update=function(){b=
new Date;var a=b-e;e=b;app.stage.act(a)};this.resize=function(){this.viewport.resize();this.create(-1)};this.start=function(){e=new Date;b=new Date;d=setInterval(this.update,TIME/FPS)};this.stop=function(){clearInterval(d);d=0};this.mouseUpdate=function(a,b){this.cursor.position.set(a,b)};this.swapState=function(){this.blocksGroup.swapState()};this.setProperties=function(a,b,c,d,e){this.blocksGroup.clear();this.create(e);this.blocksGroup.setProperties(a,b,c,d)};this.getProperties=function(){return this.blocksGroup.getProperties()};
var b,e,d=0;this.blocksGroup=new BlockGroup(void 0,void 0);this.stage=new Stage(c);this.viewport=new Viewport(a);this.cursor=new Shape(classNames.cursor);this.cursor.position.set(-this.viewport.size.x,-this.viewport.size.y)};function generateElement(c,a){tmp=document.createElement(c);tmp.className=a;return tmp}
var NAME="experience-javascript",BLUE="#2196F3",RED="#F44336",TIME=1E3,FPS=60,classNames={viewport:"ejs-viewport",cursor:"ejs-cursor",block:"ejs-block",world:"ejs-world"},global=document.getElementById(NAME),viewport=generateElement("div",classNames.viewport),world=generateElement("div",classNames.world);viewport.appendChild(world);global.appendChild(viewport);var app=new Application(world,viewport);window.addEventListener("resize",function(){app.resize()});viewport.addEventListener("click",function(){app.swapState()});
viewport.addEventListener("mousemove",function(c){app.mouseUpdate(c.clientX,c.clientY)});app.create(-1);app.start();